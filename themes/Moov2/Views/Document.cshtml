@using Orchard.Mvc.Html;
@using Orchard.UI.Resources;
@functions {
    // Sets a cookie to highlight the user has loaded assets.
    void SetCookie(string cookieName) {
        var cookie = new HttpCookie(cookieName);
        cookie.Expires = DateTime.Now.AddDays(30);
        WorkContext.HttpContext.Response.Cookies.Add(cookie);
    }
}
@{
    string cookieName = "CachedAssets";
    string title = Convert.ToString(Model.Title);
    string siteName = Convert.ToString(WorkContext.CurrentSite.SiteName);
    IHtmlString cssClasses = @Html.ClassForPage();
    string themePath = WorkContext.CurrentTheme.Location + "/" + WorkContext.CurrentTheme.Id;
    
    var hasCookie = WorkContext.HttpContext.Request.Cookies[cookieName] != null;
    
    if (!hasCookie) 
        SetCookie(cookieName);
}
<!DOCTYPE html>
<html lang="@WorkContext.CurrentCulture" class="no-js is-preload @cssClasses @(hasCookie ? "is-fonts-loaded" : "")">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0" />

        <title>@Html.Title(title, siteName)</title>

        @Display(Model.Head)
        
        <link rel="icon" href="@Url.Content(themePath + "/Content/favicon.ico")">
        
        @if (hasCookie) {
        <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,700">
        <link rel="stylesheet" type="text/css" href="@Url.Content(themePath + "/Styles/Site.css")">
        
        <script src="@Url.Content(themePath + "/Scripts/bundle.js")" async></script>
        } else {
        <meta name="fullcss"  content="@Url.Content(themePath + "/Styles/Site.css")">
        <meta name="fulljs"  content="@Url.Content(themePath + "/Scripts/bundle.js")">
        <meta name="fonts" content="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,700">
                
        <script src="@Url.Content(themePath + "/Scripts/enhance.js")"></script>
        <link rel="stylesheet" type="text/css" href="@Url.Content(themePath + "/Styles/Critical.css")" />
        
        <noscript>
            <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,700">
            <link rel="stylesheet" type="text/css" href="@Url.Content(themePath + "/Styles/Site.css")">
        </noscript>
        }
    </head>
    <body>
        @Display(Model.Body)

        @Display(Model.Tail)
    </body>
</html>